cc396c142583239bec9d04343ccf88d4
'use strict';

var NativeAnimatedModule = require("../../BatchedBridge/NativeModules").NativeAnimatedModule;

var NativeEventEmitter = require("../../EventEmitter/NativeEventEmitter");

var invariant = require('invariant');

var __nativeAnimatedNodeTagCount = 1;
var __nativeAnimationIdCount = 1;
var nativeEventEmitter;
var API = {
  createAnimatedNode: function createAnimatedNode(tag, config) {
    assertNativeAnimatedModule();
    NativeAnimatedModule.createAnimatedNode(tag, config);
  },
  startListeningToAnimatedNodeValue: function startListeningToAnimatedNodeValue(tag) {
    assertNativeAnimatedModule();
    NativeAnimatedModule.startListeningToAnimatedNodeValue(tag);
  },
  stopListeningToAnimatedNodeValue: function stopListeningToAnimatedNodeValue(tag) {
    assertNativeAnimatedModule();
    NativeAnimatedModule.stopListeningToAnimatedNodeValue(tag);
  },
  connectAnimatedNodes: function connectAnimatedNodes(parentTag, childTag) {
    assertNativeAnimatedModule();
    NativeAnimatedModule.connectAnimatedNodes(parentTag, childTag);
  },
  disconnectAnimatedNodes: function disconnectAnimatedNodes(parentTag, childTag) {
    assertNativeAnimatedModule();
    NativeAnimatedModule.disconnectAnimatedNodes(parentTag, childTag);
  },
  startAnimatingNode: function startAnimatingNode(animationId, nodeTag, config, endCallback) {
    assertNativeAnimatedModule();
    NativeAnimatedModule.startAnimatingNode(animationId, nodeTag, config, endCallback);
  },
  stopAnimation: function stopAnimation(animationId) {
    assertNativeAnimatedModule();
    NativeAnimatedModule.stopAnimation(animationId);
  },
  setAnimatedNodeValue: function setAnimatedNodeValue(nodeTag, value) {
    assertNativeAnimatedModule();
    NativeAnimatedModule.setAnimatedNodeValue(nodeTag, value);
  },
  setAnimatedNodeOffset: function setAnimatedNodeOffset(nodeTag, offset) {
    assertNativeAnimatedModule();
    NativeAnimatedModule.setAnimatedNodeOffset(nodeTag, offset);
  },
  flattenAnimatedNodeOffset: function flattenAnimatedNodeOffset(nodeTag) {
    assertNativeAnimatedModule();
    NativeAnimatedModule.flattenAnimatedNodeOffset(nodeTag);
  },
  extractAnimatedNodeOffset: function extractAnimatedNodeOffset(nodeTag) {
    assertNativeAnimatedModule();
    NativeAnimatedModule.extractAnimatedNodeOffset(nodeTag);
  },
  connectAnimatedNodeToView: function connectAnimatedNodeToView(nodeTag, viewTag) {
    assertNativeAnimatedModule();
    NativeAnimatedModule.connectAnimatedNodeToView(nodeTag, viewTag);
  },
  disconnectAnimatedNodeFromView: function disconnectAnimatedNodeFromView(nodeTag, viewTag) {
    assertNativeAnimatedModule();
    NativeAnimatedModule.disconnectAnimatedNodeFromView(nodeTag, viewTag);
  },
  dropAnimatedNode: function dropAnimatedNode(tag) {
    assertNativeAnimatedModule();
    NativeAnimatedModule.dropAnimatedNode(tag);
  },
  addAnimatedEventToView: function addAnimatedEventToView(viewTag, eventName, eventMapping) {
    assertNativeAnimatedModule();
    NativeAnimatedModule.addAnimatedEventToView(viewTag, eventName, eventMapping);
  },
  removeAnimatedEventFromView: function removeAnimatedEventFromView(viewTag, eventName, animatedNodeTag) {
    assertNativeAnimatedModule();
    NativeAnimatedModule.removeAnimatedEventFromView(viewTag, eventName, animatedNodeTag);
  }
};
var STYLES_WHITELIST = {
  opacity: true,
  transform: true,
  borderRadius: true,
  borderBottomEndRadius: true,
  borderBottomLeftRadius: true,
  borderBottomRightRadius: true,
  borderBottomStartRadius: true,
  borderTopEndRadius: true,
  borderTopLeftRadius: true,
  borderTopRightRadius: true,
  borderTopStartRadius: true,
  elevation: true,
  shadowOpacity: true,
  shadowRadius: true,
  scaleX: true,
  scaleY: true,
  translateX: true,
  translateY: true
};
var TRANSFORM_WHITELIST = {
  translateX: true,
  translateY: true,
  scale: true,
  scaleX: true,
  scaleY: true,
  rotate: true,
  rotateX: true,
  rotateY: true,
  perspective: true
};
var SUPPORTED_INTERPOLATION_PARAMS = {
  inputRange: true,
  outputRange: true,
  extrapolate: true,
  extrapolateRight: true,
  extrapolateLeft: true
};

function addWhitelistedStyleProp(prop) {
  STYLES_WHITELIST[prop] = true;
}

function addWhitelistedTransformProp(prop) {
  TRANSFORM_WHITELIST[prop] = true;
}

function addWhitelistedInterpolationParam(param) {
  SUPPORTED_INTERPOLATION_PARAMS[param] = true;
}

function validateTransform(configs) {
  configs.forEach(function (config) {
    if (!TRANSFORM_WHITELIST.hasOwnProperty(config.property)) {
      throw new Error("Property '" + config.property + "' is not supported by native animated module");
    }
  });
}

function validateStyles(styles) {
  for (var key in styles) {
    if (!STYLES_WHITELIST.hasOwnProperty(key)) {
      throw new Error("Style property '" + key + "' is not supported by native animated module");
    }
  }
}

function validateInterpolation(config) {
  for (var key in config) {
    if (!SUPPORTED_INTERPOLATION_PARAMS.hasOwnProperty(key)) {
      throw new Error("Interpolation property '" + key + "' is not supported by native animated module");
    }
  }
}

function generateNewNodeTag() {
  return __nativeAnimatedNodeTagCount++;
}

function generateNewAnimationId() {
  return __nativeAnimationIdCount++;
}

function assertNativeAnimatedModule() {
  invariant(NativeAnimatedModule, 'Native animated module is not available');
}

var _warnedMissingNativeAnimated = false;

function shouldUseNativeDriver(config) {
  if (config.useNativeDriver && !NativeAnimatedModule) {
    if (!_warnedMissingNativeAnimated) {
      console.warn('Animated: `useNativeDriver` is not supported because the native ' + 'animated module is missing. Falling back to JS-based animation. To ' + 'resolve this, add `RCTAnimation` module to this app, or remove ' + '`useNativeDriver`. ' + 'More info: https://github.com/facebook/react-native/issues/11094#issuecomment-263240420');
      _warnedMissingNativeAnimated = true;
    }

    return false;
  }

  return config.useNativeDriver || false;
}

function transformDataType(value) {
  if (typeof value !== 'string') {
    return value;
  }

  if (/deg$/.test(value)) {
    var degrees = parseFloat(value) || 0;
    var radians = degrees * Math.PI / 180.0;
    return radians;
  } else {
    return parseFloat(value) || 0;
  }
}

module.exports = {
  API: API,
  addWhitelistedStyleProp: addWhitelistedStyleProp,
  addWhitelistedTransformProp: addWhitelistedTransformProp,
  addWhitelistedInterpolationParam: addWhitelistedInterpolationParam,
  validateStyles: validateStyles,
  validateTransform: validateTransform,
  validateInterpolation: validateInterpolation,
  generateNewNodeTag: generateNewNodeTag,
  generateNewAnimationId: generateNewAnimationId,
  assertNativeAnimatedModule: assertNativeAnimatedModule,
  shouldUseNativeDriver: shouldUseNativeDriver,
  transformDataType: transformDataType,

  get nativeEventEmitter() {
    if (!nativeEventEmitter) {
      nativeEventEmitter = new NativeEventEmitter(NativeAnimatedModule);
    }

    return nativeEventEmitter;
  }

};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk5hdGl2ZUFuaW1hdGVkSGVscGVyLmpzIl0sIm5hbWVzIjpbIk5hdGl2ZUFuaW1hdGVkTW9kdWxlIiwicmVxdWlyZSIsIk5hdGl2ZUV2ZW50RW1pdHRlciIsImludmFyaWFudCIsIl9fbmF0aXZlQW5pbWF0ZWROb2RlVGFnQ291bnQiLCJfX25hdGl2ZUFuaW1hdGlvbklkQ291bnQiLCJuYXRpdmVFdmVudEVtaXR0ZXIiLCJBUEkiLCJjcmVhdGVBbmltYXRlZE5vZGUiLCJ0YWciLCJjb25maWciLCJhc3NlcnROYXRpdmVBbmltYXRlZE1vZHVsZSIsInN0YXJ0TGlzdGVuaW5nVG9BbmltYXRlZE5vZGVWYWx1ZSIsInN0b3BMaXN0ZW5pbmdUb0FuaW1hdGVkTm9kZVZhbHVlIiwiY29ubmVjdEFuaW1hdGVkTm9kZXMiLCJwYXJlbnRUYWciLCJjaGlsZFRhZyIsImRpc2Nvbm5lY3RBbmltYXRlZE5vZGVzIiwic3RhcnRBbmltYXRpbmdOb2RlIiwiYW5pbWF0aW9uSWQiLCJub2RlVGFnIiwiZW5kQ2FsbGJhY2siLCJzdG9wQW5pbWF0aW9uIiwic2V0QW5pbWF0ZWROb2RlVmFsdWUiLCJ2YWx1ZSIsInNldEFuaW1hdGVkTm9kZU9mZnNldCIsIm9mZnNldCIsImZsYXR0ZW5BbmltYXRlZE5vZGVPZmZzZXQiLCJleHRyYWN0QW5pbWF0ZWROb2RlT2Zmc2V0IiwiY29ubmVjdEFuaW1hdGVkTm9kZVRvVmlldyIsInZpZXdUYWciLCJkaXNjb25uZWN0QW5pbWF0ZWROb2RlRnJvbVZpZXciLCJkcm9wQW5pbWF0ZWROb2RlIiwiYWRkQW5pbWF0ZWRFdmVudFRvVmlldyIsImV2ZW50TmFtZSIsImV2ZW50TWFwcGluZyIsInJlbW92ZUFuaW1hdGVkRXZlbnRGcm9tVmlldyIsImFuaW1hdGVkTm9kZVRhZyIsIlNUWUxFU19XSElURUxJU1QiLCJvcGFjaXR5IiwidHJhbnNmb3JtIiwiYm9yZGVyUmFkaXVzIiwiYm9yZGVyQm90dG9tRW5kUmFkaXVzIiwiYm9yZGVyQm90dG9tTGVmdFJhZGl1cyIsImJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzIiwiYm9yZGVyQm90dG9tU3RhcnRSYWRpdXMiLCJib3JkZXJUb3BFbmRSYWRpdXMiLCJib3JkZXJUb3BMZWZ0UmFkaXVzIiwiYm9yZGVyVG9wUmlnaHRSYWRpdXMiLCJib3JkZXJUb3BTdGFydFJhZGl1cyIsImVsZXZhdGlvbiIsInNoYWRvd09wYWNpdHkiLCJzaGFkb3dSYWRpdXMiLCJzY2FsZVgiLCJzY2FsZVkiLCJ0cmFuc2xhdGVYIiwidHJhbnNsYXRlWSIsIlRSQU5TRk9STV9XSElURUxJU1QiLCJzY2FsZSIsInJvdGF0ZSIsInJvdGF0ZVgiLCJyb3RhdGVZIiwicGVyc3BlY3RpdmUiLCJTVVBQT1JURURfSU5URVJQT0xBVElPTl9QQVJBTVMiLCJpbnB1dFJhbmdlIiwib3V0cHV0UmFuZ2UiLCJleHRyYXBvbGF0ZSIsImV4dHJhcG9sYXRlUmlnaHQiLCJleHRyYXBvbGF0ZUxlZnQiLCJhZGRXaGl0ZWxpc3RlZFN0eWxlUHJvcCIsInByb3AiLCJhZGRXaGl0ZWxpc3RlZFRyYW5zZm9ybVByb3AiLCJhZGRXaGl0ZWxpc3RlZEludGVycG9sYXRpb25QYXJhbSIsInBhcmFtIiwidmFsaWRhdGVUcmFuc2Zvcm0iLCJjb25maWdzIiwiZm9yRWFjaCIsImhhc093blByb3BlcnR5IiwicHJvcGVydHkiLCJFcnJvciIsInZhbGlkYXRlU3R5bGVzIiwic3R5bGVzIiwia2V5IiwidmFsaWRhdGVJbnRlcnBvbGF0aW9uIiwiZ2VuZXJhdGVOZXdOb2RlVGFnIiwiZ2VuZXJhdGVOZXdBbmltYXRpb25JZCIsIl93YXJuZWRNaXNzaW5nTmF0aXZlQW5pbWF0ZWQiLCJzaG91bGRVc2VOYXRpdmVEcml2ZXIiLCJ1c2VOYXRpdmVEcml2ZXIiLCJjb25zb2xlIiwid2FybiIsInRyYW5zZm9ybURhdGFUeXBlIiwidGVzdCIsImRlZ3JlZXMiLCJwYXJzZUZsb2F0IiwicmFkaWFucyIsIk1hdGgiLCJQSSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJB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dUJBRmU7QUFHZkUsRUFBQUEsMkJBQTJCLEVBQTNCQSwyQkFIZTtBQUlmQyxFQUFBQSxnQ0FBZ0MsRUFBaENBLGdDQUplO0FBS2ZRLEVBQUFBLGNBQWMsRUFBZEEsY0FMZTtBQU1mTixFQUFBQSxpQkFBaUIsRUFBakJBLGlCQU5lO0FBT2ZTLEVBQUFBLHFCQUFxQixFQUFyQkEscUJBUGU7QUFRZkMsRUFBQUEsa0JBQWtCLEVBQWxCQSxrQkFSZTtBQVNmQyxFQUFBQSxzQkFBc0IsRUFBdEJBLHNCQVRlO0FBVWYxRSxFQUFBQSwwQkFBMEIsRUFBMUJBLDBCQVZlO0FBV2Y0RSxFQUFBQSxxQkFBcUIsRUFBckJBLHFCQVhlO0FBWWZJLEVBQUFBLGlCQUFpQixFQUFqQkEsaUJBWmU7O0FBYWYsTUFBSXJGLGtCQUFKLEdBQXlCO0FBQ3ZCLFFBQUksQ0FBQ0Esa0JBQUwsRUFBeUI7QUFDdkJBLE1BQUFBLGtCQUFrQixHQUFHLElBQUlKLGtCQUFKLENBQXVCRixvQkFBdkIsQ0FBckI7QUFDRDs7QUFDRCxXQUFPTSxrQkFBUDtBQUNEOztBQWxCYyxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBOYXRpdmVBbmltYXRlZE1vZHVsZSA9IHJlcXVpcmUoJy4uLy4uL0JhdGNoZWRCcmlkZ2UvTmF0aXZlTW9kdWxlcycpLk5hdGl2ZUFuaW1hdGVkTW9kdWxlO1xuY29uc3QgTmF0aXZlRXZlbnRFbWl0dGVyID0gcmVxdWlyZSgnLi4vLi4vRXZlbnRFbWl0dGVyL05hdGl2ZUV2ZW50RW1pdHRlcicpO1xuXG5jb25zdCBpbnZhcmlhbnQgPSByZXF1aXJlKCdpbnZhcmlhbnQnKTtcblxuaW1wb3J0IHR5cGUge0FuaW1hdGlvbkNvbmZpZ30gZnJvbSAnLi9hbmltYXRpb25zL0FuaW1hdGlvbic7XG5pbXBvcnQgdHlwZSB7RXZlbnRDb25maWd9IGZyb20gJy4vQW5pbWF0ZWRFdmVudCc7XG5cbmxldCBfX25hdGl2ZUFuaW1hdGVkTm9kZVRhZ0NvdW50ID0gMTsgLyogdXNlZCBmb3IgYW5pbWF0ZWQgbm9kZXMgKi9cbmxldCBfX25hdGl2ZUFuaW1hdGlvbklkQ291bnQgPSAxOyAvKiB1c2VkIGZvciBzdGFydGVkIGFuaW1hdGlvbnMgKi9cblxudHlwZSBFbmRSZXN1bHQgPSB7ZmluaXNoZWQ6IGJvb2xlYW59O1xudHlwZSBFbmRDYWxsYmFjayA9IChyZXN1bHQ6IEVuZFJlc3VsdCkgPT4gdm9pZDtcbnR5cGUgRXZlbnRNYXBwaW5nID0ge1xuICBuYXRpdmVFdmVudFBhdGg6IEFycmF5PHN0cmluZz4sXG4gIGFuaW1hdGVkVmFsdWVUYWc6ID9udW1iZXIsXG59O1xuXG5sZXQgbmF0aXZlRXZlbnRFbWl0dGVyO1xuXG4vKipcbiAqIFNpbXBsZSB3cmFwcGVycyBhcm91bmQgTmF0aXZlQW5pbWF0ZWRNb2R1bGUgdG8gcHJvdmlkZSBmbG93IGFuZCBhdXRvY21wbGV0ZSBzdXBwb3J0IGZvclxuICogdGhlIG5hdGl2ZSBtb2R1bGUgbWV0aG9kc1xuICovXG5jb25zdCBBUEkgPSB7XG4gIGNyZWF0ZUFuaW1hdGVkTm9kZTogZnVuY3Rpb24odGFnOiA/bnVtYmVyLCBjb25maWc6IE9iamVjdCk6IHZvaWQge1xuICAgIGFzc2VydE5hdGl2ZUFuaW1hdGVkTW9kdWxlKCk7XG4gICAgTmF0aXZlQW5pbWF0ZWRNb2R1bGUuY3JlYXRlQW5pbWF0ZWROb2RlKHRhZywgY29uZmlnKTtcbiAgfSxcbiAgc3RhcnRMaXN0ZW5pbmdUb0FuaW1hdGVkTm9kZVZhbHVlOiBmdW5jdGlvbih0YWc6ID9udW1iZXIpIHtcbiAgICBhc3NlcnROYXRpdmVBbmltYXRlZE1vZHVsZSgpO1xuICAgIE5hdGl2ZUFuaW1hdGVkTW9kdWxlLnN0YXJ0TGlzdGVuaW5nVG9BbmltYXRlZE5vZGVWYWx1ZSh0YWcpO1xuICB9LFxuICBzdG9wTGlzdGVuaW5nVG9BbmltYXRlZE5vZGVWYWx1ZTogZnVuY3Rpb24odGFnOiA/bnVtYmVyKSB7XG4gICAgYXNzZXJ0TmF0aXZlQW5pbWF0ZWRNb2R1bGUoKTtcbiAgICBOYXRpdmVBbmltYXRlZE1vZHVsZS5zdG9wTGlzdGVuaW5nVG9BbmltYXRlZE5vZGVWYWx1ZSh0YWcpO1xuICB9LFxuICBjb25uZWN0QW5pbWF0ZWROb2RlczogZnVuY3Rpb24ocGFyZW50VGFnOiA/bnVtYmVyLCBjaGlsZFRhZzogP251bWJlcik6IHZvaWQge1xuICAgIGFzc2VydE5hdGl2ZUFuaW1hdGVkTW9kdWxlKCk7XG4gICAgTmF0aXZlQW5pbWF0ZWRNb2R1bGUuY29ubmVjdEFuaW1hdGVkTm9kZXMocGFyZW50VGFnLCBjaGlsZFRhZyk7XG4gIH0sXG4gIGRpc2Nvbm5lY3RBbmltYXRlZE5vZGVzOiBmdW5jdGlvbihcbiAgICBwYXJlbnRUYWc6ID9udW1iZXIsXG4gICAgY2hpbGRUYWc6ID9udW1iZXIsXG4gICk6IHZvaWQge1xuICAgIGFzc2VydE5hdGl2ZUFuaW1hdGVkTW9kdWxlKCk7XG4gICAgTmF0aXZlQW5pbWF0ZWRNb2R1bGUuZGlzY29ubmVjdEFuaW1hdGVkTm9kZXMocGFyZW50VGFnLCBjaGlsZFRhZyk7XG4gIH0sXG4gIHN0YXJ0QW5pbWF0aW5nTm9kZTogZnVuY3Rpb24oXG4gICAgYW5pbWF0aW9uSWQ6ID9udW1iZXIsXG4gICAgbm9kZVRhZzogP251bWJlcixcbiAgICBjb25maWc6IE9iamVjdCxcbiAgICBlbmRDYWxsYmFjazogRW5kQ2FsbGJhY2ssXG4gICk6IHZvaWQge1xuICAgIGFzc2VydE5hdGl2ZUFuaW1hdGVkTW9kdWxlKCk7XG4gICAgTmF0aXZlQW5pbWF0ZWRNb2R1bGUuc3RhcnRBbmltYXRpbmdOb2RlKFxuICAgICAgYW5pbWF0aW9uSWQsXG4gICAgICBub2RlVGFnLFxuICAgICAgY29uZmlnLFxuICAgICAgZW5kQ2FsbGJhY2ssXG4gICAgKTtcbiAgfSxcbiAgc3RvcEFuaW1hdGlvbjogZnVuY3Rpb24oYW5pbWF0aW9uSWQ6ID9udW1iZXIpIHtcbiAgICBhc3NlcnROYXRpdmVBbmltYXRlZE1vZHVsZSgpO1xuICAgIE5hdGl2ZUFuaW1hdGVkTW9kdWxlLnN0b3BBbmltYXRpb24oYW5pbWF0aW9uSWQpO1xuICB9LFxuICBzZXRBbmltYXRlZE5vZGVWYWx1ZTogZnVuY3Rpb24obm9kZVRhZzogP251bWJlciwgdmFsdWU6ID9udW1iZXIpOiB2b2lkIHtcbiAgICBhc3NlcnROYXRpdmVBbmltYXRlZE1vZHVsZSgpO1xuICAgIE5hdGl2ZUFuaW1hdGVkTW9kdWxlLnNldEFuaW1hdGVkTm9kZVZhbHVlKG5vZGVUYWcsIHZhbHVlKTtcbiAgfSxcbiAgc2V0QW5pbWF0ZWROb2RlT2Zmc2V0OiBmdW5jdGlvbihub2RlVGFnOiA/bnVtYmVyLCBvZmZzZXQ6ID9udW1iZXIpOiB2b2lkIHtcbiAgICBhc3NlcnROYXRpdmVBbmltYXRlZE1vZHVsZSgpO1xuICAgIE5hdGl2ZUFuaW1hdGVkTW9kdWxlLnNldEFuaW1hdGVkTm9kZU9mZnNldChub2RlVGFnLCBvZmZzZXQpO1xuICB9LFxuICBmbGF0dGVuQW5pbWF0ZWROb2RlT2Zmc2V0OiBmdW5jdGlvbihub2RlVGFnOiA/bnVtYmVyKTogdm9pZCB7XG4gICAgYXNzZXJ0TmF0aXZlQW5pbWF0ZWRNb2R1bGUoKTtcbiAgICBOYXRpdmVBbmltYXRlZE1vZHVsZS5mbGF0dGVuQW5pbWF0ZWROb2RlT2Zmc2V0KG5vZGVUYWcpO1xuICB9LFxuICBleHRyYWN0QW5pbWF0ZWROb2RlT2Zmc2V0OiBmdW5jdGlvbihub2RlVGFnOiA/bnVtYmVyKTogdm9pZCB7XG4gICAgYXNzZXJ0TmF0aXZlQW5pbWF0ZWRNb2R1bGUoKTtcbiAgICBOYXRpdmVBbmltYXRlZE1vZHVsZS5leHRyYWN0QW5pbWF0ZWROb2RlT2Zmc2V0KG5vZGVUYWcpO1xuICB9LFxuICBjb25uZWN0QW5pbWF0ZWROb2RlVG9WaWV3OiBmdW5jdGlvbihcbiAgICBub2RlVGFnOiA/bnVtYmVyLFxuICAgIHZpZXdUYWc6ID9udW1iZXIsXG4gICk6IHZvaWQge1xuICAgIGFzc2VydE5hdGl2ZUFuaW1hdGVkTW9kdWxlKCk7XG4gICAgTmF0aXZlQW5pbWF0ZWRNb2R1bGUuY29ubmVjdEFuaW1hdGVkTm9kZVRvVmlldyhub2RlVGFnLCB2aWV3VGFnKTtcbiAgfSxcbiAgZGlzY29ubmVjdEFuaW1hdGVkTm9kZUZyb21WaWV3OiBmdW5jdGlvbihcbiAgICBub2RlVGFnOiA/bnVtYmVyLFxuICAgIHZpZXdUYWc6ID9udW1iZXIsXG4gICk6IHZvaWQge1xuICAgIGFzc2VydE5hdGl2ZUFuaW1hdGVkTW9kdWxlKCk7XG4gICAgTmF0aXZlQW5pbWF0ZWRNb2R1bGUuZGlzY29ubmVjdEFuaW1hdGVkTm9kZUZyb21WaWV3KG5vZGVUYWcsIHZpZXdUYWcpO1xuICB9LFxuICBkcm9wQW5pbWF0ZWROb2RlOiBmdW5jdGlvbih0YWc6ID9udW1iZXIpOiB2b2lkIHtcbiAgICBhc3NlcnROYXRpdmVBbmltYXRlZE1vZHVsZSgpO1xuICAgIE5hdGl2ZUFuaW1hdGVkTW9kdWxlLmRyb3BBbmltYXRlZE5vZGUodGFnKTtcbiAgfSxcbiAgYWRkQW5pbWF0ZWRFdmVudFRvVmlldzogZnVuY3Rpb24oXG4gICAgdmlld1RhZzogP251bWJlcixcbiAgICBldmVudE5hbWU6IHN0cmluZyxcbiAgICBldmVudE1hcHBpbmc6IEV2ZW50TWFwcGluZyxcbiAgKSB7XG4gICAgYXNzZXJ0TmF0aXZlQW5pbWF0ZWRNb2R1bGUoKTtcbiAgICBOYXRpdmVBbmltYXRlZE1vZHVsZS5hZGRBbmltYXRlZEV2ZW50VG9WaWV3KFxuICAgICAgdmlld1RhZyxcbiAgICAgIGV2ZW50TmFtZSxcbiAgICAgIGV2ZW50TWFwcGluZyxcbiAgICApO1xuICB9LFxuICByZW1vdmVBbmltYXRlZEV2ZW50RnJvbVZpZXcoXG4gICAgdmlld1RhZzogP251bWJlcixcbiAgICBldmVudE5hbWU6IHN0cmluZyxcbiAgICBhbmltYXRlZE5vZGVUYWc6ID9udW1iZXIsXG4gICkge1xuICAgIGFzc2VydE5hdGl2ZUFuaW1hdGVkTW9kdWxlKCk7XG4gICAgTmF0aXZlQW5pbWF0ZWRNb2R1bGUucmVtb3ZlQW5pbWF0ZWRFdmVudEZyb21WaWV3KFxuICAgICAgdmlld1RhZyxcbiAgICAgIGV2ZW50TmFtZSxcbiAgICAgIGFuaW1hdGVkTm9kZVRhZyxcbiAgICApO1xuICB9LFxufTtcblxuLyoqXG4gKiBTdHlsZXMgYWxsb3dlZCBieSB0aGUgbmF0aXZlIGFuaW1hdGVkIGltcGxlbWVudGF0aW9uLlxuICpcbiAqIEluIGdlbmVyYWwgbmF0aXZlIGFuaW1hdGVkIGltcGxlbWVudGF0aW9uIHNob3VsZCBzdXBwb3J0IGFueSBudW1lcmljIHByb3BlcnR5IHRoYXQgZG9lc24ndCBuZWVkXG4gKiB0byBiZSB1cGRhdGVkIHRocm91Z2ggdGhlIHNoYWRvdyB2aWV3IGhpZXJhcmNoeSAoYWxsIG5vbi1sYXlvdXQgcHJvcGVydGllcykuXG4gKi9cbmNvbnN0IFNUWUxFU19XSElURUxJU1QgPSB7XG4gIG9wYWNpdHk6IHRydWUsXG4gIHRyYW5zZm9ybTogdHJ1ZSxcbiAgYm9yZGVyUmFkaXVzOiB0cnVlLFxuICBib3JkZXJCb3R0b21FbmRSYWRpdXM6IHRydWUsXG4gIGJvcmRlckJvdHRvbUxlZnRSYWRpdXM6IHRydWUsXG4gIGJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzOiB0cnVlLFxuICBib3JkZXJCb3R0b21TdGFydFJhZGl1czogdHJ1ZSxcbiAgYm9yZGVyVG9wRW5kUmFkaXVzOiB0cnVlLFxuICBib3JkZXJUb3BMZWZ0UmFkaXVzOiB0cnVlLFxuICBib3JkZXJUb3BSaWdodFJhZGl1czogdHJ1ZSxcbiAgYm9yZGVyVG9wU3RhcnRSYWRpdXM6IHRydWUsXG4gIGVsZXZhdGlvbjogdHJ1ZSxcbiAgLyogaW9zIHN0eWxlcyAqL1xuICBzaGFkb3dPcGFjaXR5OiB0cnVlLFxuICBzaGFkb3dSYWRpdXM6IHRydWUsXG4gIC8qIGxlZ2FjeSBhbmRyb2lkIHRyYW5zZm9ybSBwcm9wZXJ0aWVzICovXG4gIHNjYWxlWDogdHJ1ZSxcbiAgc2NhbGVZOiB0cnVlLFxuICB0cmFuc2xhdGVYOiB0cnVlLFxuICB0cmFuc2xhdGVZOiB0cnVlLFxufTtcblxuY29uc3QgVFJBTlNGT1JNX1dISVRFTElTVCA9IHtcbiAgdHJhbnNsYXRlWDogdHJ1ZSxcbiAgdHJhbnNsYXRlWTogdHJ1ZSxcbiAgc2NhbGU6IHRydWUsXG4gIHNjYWxlWDogdHJ1ZSxcbiAgc2NhbGVZOiB0cnVlLFxuICByb3RhdGU6IHRydWUsXG4gIHJvdGF0ZVg6IHRydWUsXG4gIHJvdGF0ZVk6IHRydWUsXG4gIHBlcnNwZWN0aXZlOiB0cnVlLFxufTtcblxuY29uc3QgU1VQUE9SVEVEX0lOVEVSUE9MQVRJT05fUEFSQU1TID0ge1xuICBpbnB1dFJhbmdlOiB0cnVlLFxuICBvdXRwdXRSYW5nZTogdHJ1ZSxcbiAgZXh0cmFwb2xhdGU6IHRydWUsXG4gIGV4dHJhcG9sYXRlUmlnaHQ6IHRydWUsXG4gIGV4dHJhcG9sYXRlTGVmdDogdHJ1ZSxcbn07XG5cbmZ1bmN0aW9uIGFkZFdoaXRlbGlzdGVkU3R5bGVQcm9wKHByb3A6IHN0cmluZyk6IHZvaWQge1xuICBTVFlMRVNfV0hJVEVMSVNUW3Byb3BdID0gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gYWRkV2hpdGVsaXN0ZWRUcmFuc2Zvcm1Qcm9wKHByb3A6IHN0cmluZyk6IHZvaWQge1xuICBUUkFOU0ZPUk1fV0hJVEVMSVNUW3Byb3BdID0gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gYWRkV2hpdGVsaXN0ZWRJbnRlcnBvbGF0aW9uUGFyYW0ocGFyYW06IHN0cmluZyk6IHZvaWQge1xuICBTVVBQT1JURURfSU5URVJQT0xBVElPTl9QQVJBTVNbcGFyYW1dID0gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gdmFsaWRhdGVUcmFuc2Zvcm0oY29uZmlnczogQXJyYXk8T2JqZWN0Pik6IHZvaWQge1xuICBjb25maWdzLmZvckVhY2goY29uZmlnID0+IHtcbiAgICBpZiAoIVRSQU5TRk9STV9XSElURUxJU1QuaGFzT3duUHJvcGVydHkoY29uZmlnLnByb3BlcnR5KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgUHJvcGVydHkgJyR7XG4gICAgICAgICAgY29uZmlnLnByb3BlcnR5XG4gICAgICAgIH0nIGlzIG5vdCBzdXBwb3J0ZWQgYnkgbmF0aXZlIGFuaW1hdGVkIG1vZHVsZWAsXG4gICAgICApO1xuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlU3R5bGVzKHN0eWxlczogT2JqZWN0KTogdm9pZCB7XG4gIGZvciAoY29uc3Qga2V5IGluIHN0eWxlcykge1xuICAgIGlmICghU1RZTEVTX1dISVRFTElTVC5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBTdHlsZSBwcm9wZXJ0eSAnJHtrZXl9JyBpcyBub3Qgc3VwcG9ydGVkIGJ5IG5hdGl2ZSBhbmltYXRlZCBtb2R1bGVgLFxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gdmFsaWRhdGVJbnRlcnBvbGF0aW9uKGNvbmZpZzogT2JqZWN0KTogdm9pZCB7XG4gIGZvciAoY29uc3Qga2V5IGluIGNvbmZpZykge1xuICAgIGlmICghU1VQUE9SVEVEX0lOVEVSUE9MQVRJT05fUEFSQU1TLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEludGVycG9sYXRpb24gcHJvcGVydHkgJyR7a2V5fScgaXMgbm90IHN1cHBvcnRlZCBieSBuYXRpdmUgYW5pbWF0ZWQgbW9kdWxlYCxcbiAgICAgICk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlTmV3Tm9kZVRhZygpOiBudW1iZXIge1xuICByZXR1cm4gX19uYXRpdmVBbmltYXRlZE5vZGVUYWdDb3VudCsrO1xufVxuXG5mdW5jdGlvbiBnZW5lcmF0ZU5ld0FuaW1hdGlvbklkKCk6IG51bWJlciB7XG4gIHJldHVybiBfX25hdGl2ZUFuaW1hdGlvbklkQ291bnQrKztcbn1cblxuZnVuY3Rpb24gYXNzZXJ0TmF0aXZlQW5pbWF0ZWRNb2R1bGUoKTogdm9pZCB7XG4gIGludmFyaWFudChOYXRpdmVBbmltYXRlZE1vZHVsZSwgJ05hdGl2ZSBhbmltYXRlZCBtb2R1bGUgaXMgbm90IGF2YWlsYWJsZScpO1xufVxuXG5sZXQgX3dhcm5lZE1pc3NpbmdOYXRpdmVBbmltYXRlZCA9IGZhbHNlO1xuXG5mdW5jdGlvbiBzaG91bGRVc2VOYXRpdmVEcml2ZXIoY29uZmlnOiBBbmltYXRpb25Db25maWcgfCBFdmVudENvbmZpZyk6IGJvb2xlYW4ge1xuICBpZiAoY29uZmlnLnVzZU5hdGl2ZURyaXZlciAmJiAhTmF0aXZlQW5pbWF0ZWRNb2R1bGUpIHtcbiAgICBpZiAoIV93YXJuZWRNaXNzaW5nTmF0aXZlQW5pbWF0ZWQpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgJ0FuaW1hdGVkOiBgdXNlTmF0aXZlRHJpdmVyYCBpcyBub3Qgc3VwcG9ydGVkIGJlY2F1c2UgdGhlIG5hdGl2ZSAnICtcbiAgICAgICAgICAnYW5pbWF0ZWQgbW9kdWxlIGlzIG1pc3NpbmcuIEZhbGxpbmcgYmFjayB0byBKUy1iYXNlZCBhbmltYXRpb24uIFRvICcgK1xuICAgICAgICAgICdyZXNvbHZlIHRoaXMsIGFkZCBgUkNUQW5pbWF0aW9uYCBtb2R1bGUgdG8gdGhpcyBhcHAsIG9yIHJlbW92ZSAnICtcbiAgICAgICAgICAnYHVzZU5hdGl2ZURyaXZlcmAuICcgK1xuICAgICAgICAgICdNb3JlIGluZm86IGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWFjdC1uYXRpdmUvaXNzdWVzLzExMDk0I2lzc3VlY29tbWVudC0yNjMyNDA0MjAnLFxuICAgICAgKTtcbiAgICAgIF93YXJuZWRNaXNzaW5nTmF0aXZlQW5pbWF0ZWQgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICByZXR1cm4gY29uZmlnLnVzZU5hdGl2ZURyaXZlciB8fCBmYWxzZTtcbn1cblxuZnVuY3Rpb24gdHJhbnNmb3JtRGF0YVR5cGUodmFsdWU6IGFueSk6IG51bWJlciB7XG4gIC8vIENoYW5nZSB0aGUgc3RyaW5nIHR5cGUgdG8gbnVtYmVyIHR5cGUgc28gd2UgY2FuIHJldXNlIHRoZSBzYW1lIGxvZ2ljIGluXG4gIC8vIGlPUyBhbmQgQW5kcm9pZCBwbGF0Zm9ybVxuICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuICBpZiAoL2RlZyQvLnRlc3QodmFsdWUpKSB7XG4gICAgY29uc3QgZGVncmVlcyA9IHBhcnNlRmxvYXQodmFsdWUpIHx8IDA7XG4gICAgY29uc3QgcmFkaWFucyA9IChkZWdyZWVzICogTWF0aC5QSSkgLyAxODAuMDtcbiAgICByZXR1cm4gcmFkaWFucztcbiAgfSBlbHNlIHtcbiAgICAvLyBBc3N1bWUgcmFkaWFuc1xuICAgIHJldHVybiBwYXJzZUZsb2F0KHZhbHVlKSB8fCAwO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBBUEksXG4gIGFkZFdoaXRlbGlzdGVkU3R5bGVQcm9wLFxuICBhZGRXaGl0ZWxpc3RlZFRyYW5zZm9ybVByb3AsXG4gIGFkZFdoaXRlbGlzdGVkSW50ZXJwb2xhdGlvblBhcmFtLFxuICB2YWxpZGF0ZVN0eWxlcyxcbiAgdmFsaWRhdGVUcmFuc2Zvcm0sXG4gIHZhbGlkYXRlSW50ZXJwb2xhdGlvbixcbiAgZ2VuZXJhdGVOZXdOb2RlVGFnLFxuICBnZW5lcmF0ZU5ld0FuaW1hdGlvbklkLFxuICBhc3NlcnROYXRpdmVBbmltYXRlZE1vZHVsZSxcbiAgc2hvdWxkVXNlTmF0aXZlRHJpdmVyLFxuICB0cmFuc2Zvcm1EYXRhVHlwZSxcbiAgZ2V0IG5hdGl2ZUV2ZW50RW1pdHRlcigpIHtcbiAgICBpZiAoIW5hdGl2ZUV2ZW50RW1pdHRlcikge1xuICAgICAgbmF0aXZlRXZlbnRFbWl0dGVyID0gbmV3IE5hdGl2ZUV2ZW50RW1pdHRlcihOYXRpdmVBbmltYXRlZE1vZHVsZSk7XG4gICAgfVxuICAgIHJldHVybiBuYXRpdmVFdmVudEVtaXR0ZXI7XG4gIH0sXG59O1xuIl19